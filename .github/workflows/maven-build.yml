name: Java CI with Maven

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    permissions: write-all
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up JDK 8
      uses: actions/setup-java@v4
      with:
        java-version: '8'
        distribution: 'corretto'
        cache: maven
    
    - name: Build with Maven
      run: mvn -B package --file pom.xml
    
    - name: ğŸ§ªâœ…âŒ Publish Test Repor
      id: test_results
      uses: dorny/test-reporter@v1.8.0
      if: always()
      with:
        name: ğŸ§ªğŸ“Š Unit tests report
        path: target/surefire-reports/*.xml
        reporter: java-junit
        fail-on-error: true

    - name: Create Test Results Badge
      uses: schneegans/dynamic-badges-action@v1.7.0
      with:
        auth: ${{ secrets.GIST_TOKEN }}
        gistID: "1adc6e2e2a100187949bb9fcec235421"
        filename: "PermuteMMOFilter-junit.json"
        style: 'plastic'
        namedLogo: 'junit5'
        label: 'Tests'
        labelColor: '#3d454d'
        message: "${{ steps.test_results.outputs.passed }} passed${{ steps.test_results.outputs.failed > 0 && format(', {0} failed', steps.test_results.outputs.failed) || ''}}${{ steps.test_results.outputs.skipped > 0 && format(', {0} skipped') || ''}}"
        color: ${{ steps.test_results.outputs.conclusion == 'success' && '#32c955' || 'red' }}
        link: "['${{steps.test_results.outputs.url}}']"
                
